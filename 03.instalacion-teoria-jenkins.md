# ðŸ“¦ SecciÃ³n 3: InstalaciÃ³n y teorÃ­a de Jenkins

*ðŸ“ `Nota`: No hay un archivo `Markdown (md)` especÃ­fico para la `secciÃ³n 2` y `secciÃ³n 3` del curso, ya que esas
secciones contienen informaciÃ³n introductoria de cÃ³mo llevar el curso, introducciÃ³n a la integraciÃ³n continÃºa, etc. todo
eso lo vimos directamente en el `README` general.*

---

## ðŸ³ InstalaciÃ³n de Jenkins en Docker

En esta secciÃ³n instalaremos `Jenkins` utilizando `Docker`, que es la forma mÃ¡s comÃºn y recomendada en entornos de
desarrollo modernos. Esta aproximaciÃ³n nos permite:

- âœ… Tener Jenkins ejecutÃ¡ndose en minutos.
- âœ… Aislar Jenkins del sistema operativo host.
- âœ… Facilitar la portabilidad entre diferentes mÃ¡quinas.
- âœ… Simplificar actualizaciones y mantenimiento.

#### ðŸ“š Fuentes oficiales consultadas

> - [Imagen oficial de Jenkins en Docker Hub](https://hub.docker.com/r/jenkins/jenkins)
> - [DocumentaciÃ³n de Jenkins en GitHub](https://github.com/jenkinsci/docker/blob/master/README.md)
> - [PÃ¡gina oficial de Jenkins](https://www.jenkins.io/)

### ðŸ§° ConfiguraciÃ³n del Docker Compose

En nuestro proyecto `jenkins-guide` creamos el archivo de configuraciÃ³n en la ruta `docker/compose.yml` con el siguiente
contenido:

````yml
services:
  s-jenkins:
    image: jenkins/jenkins:2.535-jdk21
    container_name: c-jenkins
    restart: unless-stopped
    ports:
      - '8080:8080'     # ðŸŒ Acceso web a Jenkins
      - '50000:50000'   # ðŸ”— ComunicaciÃ³n con agentes remotos
    volumes:
      - jenkins_home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - jenkins-net

volumes:
  jenkins_home:
    name: jenkins_home

networks:
  jenkins-net:
    name: jenkins-net
````

ðŸ“‹ ExplicaciÃ³n detallada de la configuraciÃ³n

- Puerto `8080:8080`
    - Puerto principal de la `interfaz web de Jenkins`.
    - AquÃ­ accederÃ¡s a Jenkins desde tu navegador: `http://localhost:8080`
    - Es donde configurarÃ¡s `jobs`, verÃ¡s `pipelines`, revisarÃ¡s `logs`, etc.
- Puerto `50000:50000`
    - Puerto usado para la comunicaciÃ³n con agentes Jenkins (Jenkins agents/slaves).
    - Permite que nodos adicionales se conecten al master Jenkins para ejecutar trabajos de forma distribuida.
    - Ãštil cuando necesitas escalar horizontalmente (mÃºltiples mÃ¡quinas ejecutando builds en paralelo).
    - ðŸ¢ En empresas: Es comÃºn tener un Jenkins master (controlador) y varios agents (nodos workers) para distribuir la
      carga de trabajo. El puerto 50000 facilita esta comunicaciÃ³n.
- Named Volume: `jenkins_home:/var/jenkins_home`
    - `jenkins_home`: Volumen con nombre gestionado por Docker.
    - `/var/jenkins_home`: Directorio dentro del contenedor donde `Jenkins` almacena toda su informaciÃ³n.
    - âš ï¸ `Importante`: Si eliminas el contenedor pero conservas este volumen, no perderÃ¡s tu configuraciÃ³n de Jenkins.
      Puedes recrear el contenedor y todo seguirÃ¡ funcionando.
- Bind Mount: `/var/run/docker.sock:/var/run/docker.sock`
    - Este es uno de los conceptos mÃ¡s importantes para entender cÃ³mo `Jenkins` puede interactuar con `Docker`.
    - El archivo `/var/run/docker.sock` en tu mÃ¡quina es el canal de comunicaciÃ³n entre el cliente Docker y el daemon
      Docker.
    - Al montar el socket Docker `(/var/run/docker.sock)` del host dentro del contenedor de Jenkins, estÃ¡s dÃ¡ndole a
      Jenkins la capacidad de comunicarse directamente con el Docker daemon del host. Esto significa que Jenkins
      (corriendo dentro de un contenedor) puede:
        - âœ… Construir imÃ¡genes Docker: `docker build -t mi-app:1.0 .`
        - âœ… Ejecutar contenedores: `docker run -d mi-app:1.0`
        - âœ… Listar contenedores: `docker container ls`
        - âœ… Eliminar contenedores/imÃ¡genes
        - âœ… Ejecutar `Docker Compose`.
    - Es como si Jenkins estuviera instalado directamente en tu mÃ¡quina host, con acceso total a Docker.

### ðŸ“ Â¿DÃ³nde estÃ¡ `/var/run/docker.sock` si estÃ¡s en Windows?

En sistemas Linux, ese archivo existe fÃ­sicamente en `/var/run/docker.sock`. Pero en Windows, especialmente si usas
`Docker Desktop`, el entorno es diferente:

#### Â¿QuÃ© pasa en Windows?

- Docker Desktop para Windows corre sobre una mÃ¡quina virtual ligera (WSL2 o Hyper-V).
- El archivo `/var/run/docker.sock` no estÃ¡ en tu sistema de archivos Windows directamente  (no en `C:\` ni `D:\`),
  sino dentro de esa `VM` de `WSL2` que Docker Desktop gestiona automÃ¡ticamente.
- Cuando usas Docker Compose en Windows, `Docker Desktop` emula esa ruta para que el `bind mount` funcione como si
  estuvieras en Linux.

> âœ… `ConclusiÃ³n`: Aunque no veas `/var/run/docker.sock` en tu disco `C:`, `Docker Desktop` lo expone virtualmente para
> que puedas usarlo en bind mounts como si estuvieras en Linux.
>
> Por eso esta lÃ­nea funciona igual en Windows, Mac y Linux: `/var/run/docker.sock:/var/run/docker.sock`.
>
> ðŸ’¡ `En la prÃ¡ctica`: No necesitas hacer nada especial en Windows. Docker Desktop se encarga de todo automÃ¡ticamente.

### ðŸ“Œ Diferencia entre volumen y bind mount

| Tipo         | Â¿QuÃ© es?                                     | Ejemplo                                      | Â¿QuiÃ©n lo gestiona?       |
|--------------|----------------------------------------------|----------------------------------------------|---------------------------|
| `Bind mount` | Montaje directo de una ruta del host         | `/var/run/docker.sock:/var/run/docker.sock ` | TÃº lo defines manualmente |
| `Volume`     | Ãrea gestionada por Docker para persistencia | `jenkins_home:/var/jenkins_home`             | Docker lo crea y gestiona |

#### ðŸ§  Nota tÃ©cnica sobre bind mounts en Windows

> En Windows, los `bind mounts` usan rutas como `D:\data:/app/data`. Sin embargo, rutas como `/var/run/docker.sock`
> funcionan porque `Docker Desktop` las emula internamente para permitir acceso al daemon Docker desde contenedores.

