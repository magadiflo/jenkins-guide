# ğŸ“¦ SecciÃ³n 3: InstalaciÃ³n y teorÃ­a de Jenkins

---

## ğŸ§  Â¿QuÃ© es Jenkins?

`Jenkins` es un `servidor de automatizaciÃ³n de cÃ³digo abierto` ampliamente utilizado para implementar prÃ¡cticas de
`IntegraciÃ³n Continua (CI)` y `Entrega/Despliegue Continuo (CD)`.

Permite automatizar tareas como la compilaciÃ³n, prueba, empaquetado, anÃ¡lisis de calidad y despliegue de aplicaciones.

### ğŸ” CaracterÃ­sticas clave

- ğŸ› ï¸ `Herramienta CI/CD de cÃ³digo abierto`, escrita completamente en Java.
- ğŸ§© Ofrece mÃ¡s de 1800 plugins para integrar con herramientas como Git, Maven, Docker, SonarQube, Kubernetes, Slack,
  entre otros.
- ğŸ’¡ Permite automatizar tareas como:
    - CompilaciÃ³n de cÃ³digo (`Build`).
    - EjecuciÃ³n de pruebas (`Test`).
    - AnÃ¡lisis de calidad (`Code Quality`).
    - Empaquetado y despliegue (`Package & Deploy`).
- ğŸŒ Accesible vÃ­a navegador en http://localhost:8080 (por defecto).
- ğŸ’° Totalmente gratuito, mantenido por la comunidad y la FundaciÃ³n Jenkins.

### ğŸš€ Â¿Por quÃ© usar Jenkins?

`Jenkins` es ideal para equipos que buscan:

- Automatizar el ciclo de vida de desarrollo.
- Detectar errores rÃ¡pidamente mediante pipelines de CI.
- Preparar artefactos listos para producciÃ³n (`Entrega Continua`).
- Desplegar automÃ¡ticamente en ambientes reales (`Despliegue Continuo`).
- Integrarse con herramientas corporativas y flujos DevOps.

### ğŸ“Œ En resumen

> `Jenkins` es una herramienta de automatizaciÃ³n que permite construir, probar y entregar software de forma confiable,
> repetible y escalable.

## ğŸ³ InstalaciÃ³n de Jenkins en Docker

En esta secciÃ³n instalaremos `Jenkins` utilizando `Docker`, que es la forma mÃ¡s comÃºn y recomendada en entornos de
desarrollo modernos. Esta aproximaciÃ³n nos permite:

- âœ… Tener Jenkins ejecutÃ¡ndose en minutos.
- âœ… Aislar Jenkins del sistema operativo host.
- âœ… Facilitar la portabilidad entre diferentes mÃ¡quinas.
- âœ… Simplificar actualizaciones y mantenimiento.

#### ğŸ“š Fuentes oficiales consultadas

> - [Imagen oficial de Jenkins en Docker Hub](https://hub.docker.com/r/jenkins/jenkins)
> - [DocumentaciÃ³n de Jenkins en GitHub](https://github.com/jenkinsci/docker/blob/master/README.md)
> - [PÃ¡gina oficial de Jenkins](https://www.jenkins.io/)

### ğŸ§° ConfiguraciÃ³n del Docker Compose

En nuestro proyecto `jenkins-guide` creamos el archivo de configuraciÃ³n en la ruta `docker/compose.yml` con el siguiente
contenido:

````yml
services:
  s-jenkins:
    image: jenkins/jenkins:2.535-jdk21
    container_name: c-jenkins
    restart: unless-stopped
    ports:
      - '8080:8080'     # ğŸŒ Acceso web a Jenkins
      - '50000:50000'   # ğŸ”— ComunicaciÃ³n con agentes remotos
    volumes:
      - jenkins_home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - jenkins-net

volumes:
  jenkins_home:
    name: jenkins_home

networks:
  jenkins-net:
    name: jenkins-net
````

ğŸ“‹ ExplicaciÃ³n detallada de la configuraciÃ³n

- Puerto `8080:8080`
    - Puerto principal de la `interfaz web de Jenkins`.
    - AquÃ­ accederÃ¡s a Jenkins desde tu navegador: `http://localhost:8080`
    - Es donde configurarÃ¡s `jobs`, verÃ¡s `pipelines`, revisarÃ¡s `logs`, etc.
- Puerto `50000:50000`
    - Puerto usado para la comunicaciÃ³n con agentes Jenkins (Jenkins agents/slaves).
    - Permite que nodos adicionales se conecten al master Jenkins para ejecutar trabajos de forma distribuida.
    - Ãštil cuando necesitas escalar horizontalmente (mÃºltiples mÃ¡quinas ejecutando builds en paralelo).
    - ğŸ¢ En empresas: Es comÃºn tener un Jenkins master (controlador) y varios agents (nodos workers) para distribuir la
      carga de trabajo. El puerto 50000 facilita esta comunicaciÃ³n.
- Named Volume: `jenkins_home:/var/jenkins_home`
    - `jenkins_home`: Volumen con nombre gestionado por Docker.
    - `/var/jenkins_home`: Directorio dentro del contenedor donde `Jenkins` almacena toda su informaciÃ³n.
    - âš ï¸ `Importante`: Si eliminas el contenedor pero conservas este volumen, no perderÃ¡s tu configuraciÃ³n de Jenkins.
      Puedes recrear el contenedor y todo seguirÃ¡ funcionando.
- Bind Mount: `/var/run/docker.sock:/var/run/docker.sock`
    - Este es uno de los conceptos mÃ¡s importantes para entender cÃ³mo `Jenkins` puede interactuar con `Docker`.
    - El archivo `/var/run/docker.sock` en tu mÃ¡quina es el canal de comunicaciÃ³n entre el cliente Docker y el daemon
      Docker.
    - Al montar el socket Docker `(/var/run/docker.sock)` del host dentro del contenedor de Jenkins, estÃ¡s dÃ¡ndole a
      Jenkins la capacidad de comunicarse directamente con el Docker daemon del host. Esto significa que Jenkins
      (corriendo dentro de un contenedor) puede:
        - âœ… Construir imÃ¡genes Docker: `docker build -t mi-app:1.0 .`
        - âœ… Ejecutar contenedores: `docker run -d mi-app:1.0`
        - âœ… Listar contenedores: `docker container ls`
        - âœ… Eliminar contenedores/imÃ¡genes
        - âœ… Ejecutar `Docker Compose`.
    - Es como si Jenkins estuviera instalado directamente en tu mÃ¡quina host, con acceso total a Docker.

### ğŸ“ Â¿DÃ³nde estÃ¡ `/var/run/docker.sock` si estÃ¡s en Windows?

En sistemas Linux, ese archivo existe fÃ­sicamente en `/var/run/docker.sock`. Pero en Windows, especialmente si usas
`Docker Desktop`, el entorno es diferente:

#### Â¿QuÃ© pasa en Windows?

- Docker Desktop para Windows corre sobre una mÃ¡quina virtual ligera (WSL2 o Hyper-V).
- El archivo `/var/run/docker.sock` no estÃ¡ en tu sistema de archivos Windows directamente  (no en `C:\` ni `D:\`),
  sino dentro de esa `VM` de `WSL2` que Docker Desktop gestiona automÃ¡ticamente.
- Cuando usas Docker Compose en Windows, `Docker Desktop` emula esa ruta para que el `bind mount` funcione como si
  estuvieras en Linux.

> âœ… `ConclusiÃ³n`: Aunque no veas `/var/run/docker.sock` en tu disco `C:`, `Docker Desktop` lo expone virtualmente para
> que puedas usarlo en bind mounts como si estuvieras en Linux.
>
> Por eso esta lÃ­nea funciona igual en Windows, Mac y Linux: `/var/run/docker.sock:/var/run/docker.sock`.
>
> ğŸ’¡ `En la prÃ¡ctica`: No necesitas hacer nada especial en Windows. Docker Desktop se encarga de todo automÃ¡ticamente.

### ğŸ“Œ Diferencia entre volumen y bind mount

| Tipo         | Â¿QuÃ© es?                                     | Ejemplo                                      | Â¿QuiÃ©n lo gestiona?       |
|--------------|----------------------------------------------|----------------------------------------------|---------------------------|
| `Bind mount` | Montaje directo de una ruta del host         | `/var/run/docker.sock:/var/run/docker.sock ` | TÃº lo defines manualmente |
| `Volume`     | Ãrea gestionada por Docker para persistencia | `jenkins_home:/var/jenkins_home`             | Docker lo crea y gestiona |

#### ğŸ§  Nota tÃ©cnica sobre bind mounts en Windows

> En Windows, los `bind mounts` usan rutas como `D:\data:/app/data`. Sin embargo, rutas como `/var/run/docker.sock`
> funcionan porque `Docker Desktop` las emula internamente para permitir acceso al daemon Docker desde contenedores.

## ğŸš€ Levantando el contenedor de Jenkins

En esta secciÃ³n ejecutamos nuestro archivo `compose.yml` para levantar el contenedor de `Jenkins` y completar la
configuraciÃ³n inicial desde el navegador.

### ğŸ³ Paso 1: Ejecutar Docker Compose

Desde la raÃ­z del proyecto, ejecutamos el siguiente comando:

````bash
D:\programming\jenkins\jenkins-guide (section-03)
$ docker compose -f ./docker/compose.yml up -d   
[+] Running 13/13                                
 âœ” s-jenkins Pulled                              
...                
[+] Running 3/3                                  
 âœ” Network jenkins-net  Created                  
 âœ” Volume jenkins_home  Created                  
 âœ” Container c-jenkins  Started                   
````

ğŸ“¦ Esto realiza las siguientes acciones:

- Descarga la imagen `jenkins/jenkins:2.535-jdk21`.
- Crea la red `jenkins-net`.
- Crea el volumen persistente `jenkins_home`.
- Inicia el contenedor `c-jenkins`.

### ğŸ” Paso 2: Verificar que Jenkins estÃ¡ corriendo

Listamos los contenedores activos:

````bash
$ docker container ls -a
CONTAINER ID   IMAGE                         COMMAND                  CREATED              STATUS          PORTS                                                                                          NAMES
b0398924ad26   jenkins/jenkins:2.535-jdk21   "/usr/bin/tini -- /uâ€¦"   About a minute ago   Up 49 seconds   0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp, 0.0.0.0:50000->50000/tcp, [::]:50000->50000/tcp   c-jenkins 
````

### ğŸ” Paso 3: Obtener la contraseÃ±a inicial de administrador

`Jenkins` genera una contraseÃ±a temporal para el primer acceso. Podemos obtenerla de dos formas:

#### OpciÃ³n A: Comando directo

````bash
D:\programming\jenkins\jenkins-guide (section-03)
$ docker container exec c-jenkins cat /var/jenkins_home/secrets/initialAdminPassword
69ad09721dc649bb81a1a1394a9fc78b
````

#### OpciÃ³n B: Acceder al contenedor manualmente

````bash
D:\programming\jenkins\jenkins-guide (section-03)
$ docker container exec -it c-jenkins /bin/sh
$ cd /var/jenkins_home/secrets/
$ ls -l
total 16
-rw-r--r-- 1 jenkins jenkins  48 Nov  6 17:54 hudson.model.User.DIRNAMES
-rw-r----- 1 jenkins jenkins  33 Nov  6 17:54 initialAdminPassword
-rw-r--r-- 1 jenkins jenkins  32 Nov  6 17:54 jenkins.model.Jenkins.crumbSalt
-rw-r--r-- 1 jenkins jenkins 256 Nov  6 17:54 master.key
$ cat initialAdminPassword
69ad09721dc649bb81a1a1394a9fc78b
````

ğŸ“ Este archivo contiene la contraseÃ±a que `Jenkins` nos pedirÃ¡ al ingresar por primera vez.

### ğŸŒ Paso 4: Acceder a Jenkins desde el navegador

Abrimos http://localhost:8080 y veremos la pantalla de desbloqueo:

![01.png](assets/section-03/01.png)

Ingresamos la contraseÃ±a obtenida en el paso anterior y continuamos.

### ğŸ”Œ Paso 5: Instalar plugins recomendados

`Jenkins` nos da dos opciones:

- Instalar plugins recomendados âœ…
- Seleccionar plugins manualmente

Seleccionamos la primera opciÃ³n:

![02.png](assets/section-03/02.png)

ğŸ”„ Esperamos a que finalice la instalaciÃ³n:

![03.png](assets/section-03/03.png)

### ğŸ‘¤ Paso 6: Crear usuario administrador

Luego de finalizada la instalaciÃ³n de los plugins, nos mostrarÃ¡ una interfaz para poder crear un usuario administrador.
En mi caso usarÃ© la siguiente informaciÃ³n:

````bash
usuario: admin
contraseÃ±a: admin
Nombre completo: System Admin
DirecciÃ³n de email: admin@admin
````

![04.png](assets/section-03/04.png)

### ğŸ”— Paso 7: Confirmar URL y finalizar

`Jenkins` nos muestra la URL base del servidor `http://localhost:8080`. Confirmamos y finalizamos:

![05.png](assets/section-03/05.png)

### âœ… Paso 8: Jenkins estÃ¡ listo

Vemos la pantalla de bienvenida:

![06.png](assets/section-03/06.png)

Al hacer clic en Start using Jenkins, accedemos al panel principal:

![07.png](assets/section-03/07.png)

### ğŸ§  Notas tÃ©cnicas

- El archivo `initialAdminPassword` se genera automÃ¡ticamente en el volumen `jenkins_home`.
- Si reinicias el contenedor, `Jenkins` conservarÃ¡ la configuraciÃ³n gracias al volumen persistente.
- Puedes acceder al contenedor en cualquier momento con `docker container exec -it c-jenkins /bin/sh`.
