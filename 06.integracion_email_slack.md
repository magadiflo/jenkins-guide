# üì© Integraci√≥n de Jenkins con Email y Slack

---

## üß≠ ¬øPor qu√© integrar Jenkins con Email y Slack?

La integraci√≥n de `Jenkins` con sistemas de notificaci√≥n como `Email` y `Slack` tiene un prop√≥sito esencial en los
entornos de `CI/CD (Integraci√≥n y Despliegue Continuos)`: mantener al equipo `informado en tiempo real` sobre el
estado de las ejecuciones.

### üéØ Objetivos principales

- üì¢ `Alertar al equipo de forma inmediata` ante una compilaci√≥n fallida (`broken build`).
- üöÄ `Aumentar la productividad` y capacidad de respuesta del equipo de desarrollo.
- üëÄ `Monitorear autom√°ticamente` los trabajos sin necesidad de revisar manualmente el panel de `Jenkins`.
- üîÑ `Reaccionar r√°pidamente` ante fallas para evitar la propagaci√≥n de errores a entornos posteriores.

### üí° Ejemplo real en empresas

En una pipeline real, los equipos configuran `Jenkins` para notificar:

- √âxito o fallo de un build.
- Resultados de pruebas unitarias o de integraci√≥n.
- Despliegues completados en entornos de staging o producci√≥n.

De esta forma, un DevOps engineer o un desarrollador puede actuar inmediatamente ante un problema sin necesidad de
abrir Jenkins.

### ‚öôÔ∏è C√≥mo funciona la comunicaci√≥n

Existen dos enfoques principales para mantener a `Jenkins` y los desarrolladores sincronizados:

| Tipo de flujo                    | Descripci√≥n                                                                                                                                                                                    |
|----------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Pull` (consulta peri√≥dica)      | Jenkins consulta el sistema de control de versiones (por ejemplo, GitHub o GitLab) cada cierto intervalo de tiempo para detectar cambios.                                                      |
| `Push` (notificaci√≥n autom√°tica) | El sistema de control de versiones env√≠a directamente una notificaci√≥n (`webhook`) a Jenkins cada vez que hay un nuevo `commit` o `push`. Este m√©todo es el m√°s eficiente y usado actualmente. |

üí° Mejor pr√°ctica recomendada
> Las empresas modernas prefieren el modelo `‚Äúpush‚Äù` usando `webhooks`, ya que reduce la carga de `Jenkins` y garantiza
> una respuesta inmediata a los cambios de c√≥digo.

## üìß Instalaci√≥n del Email Extension Plugin

Por defecto, cuando instalamos `Jenkins`, el sistema incluye el plugin de correo electr√≥nico b√°sico, encargado de enviar
notificaciones simples. Sin embargo, para obtener m√°s flexibilidad y control sobre el formato y los destinatarios, es
recomendable usar el `Email Extension Plugin` (`Email-ext`).

Para comprobar si ya est√° instalado:

1. Navega a: `Administrar Jenkins` ‚Üí `Plugins`

![01.png](assets/section-06/01.png)

2. Selecciona la pesta√±a `Installed plugins` (Plugins instalados)
3. En el campo de b√∫squeda escribe: `Email`

![02.png](assets/section-06/02.png)

Como vemos, el resultado anterior muestra el plugin `Email Extension Plugin`, eso significa que ya lo tenemos instalado.

> Con esta comprobaci√≥n podemos concluir que el plugin de Email se encuentra correctamente instalado y disponible para
> configurar notificaciones.

### üí° Nota

El `Email Extension Plugin` ampl√≠a las capacidades del plugin de correo est√°ndar. Permite:

- Personalizar el asunto y cuerpo del mensaje (incluso usando variables de entorno de `Jenkins`).
- Definir `plantillas HTML` para reportes m√°s visuales.
- Enviar notificaciones condicionadas (por ejemplo, solo cuando el build falla).

## üì¨ Integraci√≥n de Jenkins con Gmail

### ‚ú® Configuraci√≥n general

El objetivo de esta secci√≥n es permitir que `Jenkins pueda enviar correos autom√°ticos` ante eventos relevantes, como
fallos de compilaci√≥n o ejecuciones exitosas. Para este ejemplo usaremos `Gmail como servidor SMTP`, lo que nos
permitir√° realizar pruebas reales sin necesidad de un servidor de correo propio.

### üîê Crear una contrase√±a de aplicaci√≥n en Gmail

Para mantener la seguridad de tu cuenta, `no se debe usar la contrase√±a real de Gmail en Jenkins`. En su lugar, se crea
una `contrase√±a de aplicaci√≥n`, especialmente dise√±ada para integraciones con terceros.

üîó `Referencia oficial`:
[Iniciar sesi√≥n con contrase√±as de aplicaci√≥n](https://support.google.com/accounts/answer/185833?hl=es)

üß≠ Pasos para generar la contrase√±a

1. Accede a tu [cuenta de Google](https://myaccount.google.com/).
2. Selecciona la pesta√±a `Seguridad`.
3. En la secci√≥n `C√≥mo inicias sesi√≥n en Google`, activa o revisa la `Verificaci√≥n en dos pasos`.
4. Una vez activada, aparecer√° una nueva opci√≥n: `Contrase√±as de aplicaci√≥n`.
5. Crea una nueva contrase√±a con un nombre descriptivo, por ejemplo: `Jenkins CI/CD`.
6. Google mostrar√° una contrase√±a de `16 caracteres`. Copia esta contrase√±a y gu√°rdala en un lugar seguro, ya que ser√°
   la que `Jenkins` usar√° para autenticar el env√≠o de correos.

üîó `Acceso directo`: Puedes ir directamente al `paso 5` ingresando a https://myaccount.google.com/apppasswords

‚öôÔ∏è Explicaci√≥n t√©cnica

> Las `contrase√±as de aplicaci√≥n` son tokens √∫nicos generados por Google para reemplazar tu contrase√±a real cuando un
> servicio (como Jenkins) se conecta mediante SMTP. No requieren verificaci√≥n de dos pasos y pueden revocarse en
> cualquier momento.

### ‚öôÔ∏è Configurar el servidor SMTP en Jenkins

Como siguiente paso vamos a configurar el servidor de correo. Para eso seguimos los siguientes pasos:

1. En el panel principal de Jenkins, dir√≠gete a: `Administrar Jenkins` ‚Üí `System`

![03.png](assets/section-06/03.png)

2. Despl√°zate hasta la secci√≥n `Notificaci√≥n por correo electr√≥nico` y completa los campos con la siguiente informaci√≥n:

| Campo              | Valor                             |
|--------------------|-----------------------------------|
| Servidor SMTP      | `smtp.gmail.com`                  |
| Autenticaci√≥n SMTP | ‚úÖ Activado                        |
| Usuario            | `tucorreo@gmail.com`              |
| Contrase√±a         | Contrase√±a de aplicaci√≥n generada |
| Seguridad SSL      | ‚úÖ Activado                        |
| Puerto SMTP        | `465`                             |

![04.png](assets/section-06/04.png)

3. Antes de guardar, realiza una `prueba de env√≠o de correo`:

- Marca la casilla `‚ÄúProbar la configuraci√≥n enviando un correo de prueba‚Äù`.
- Introduce un correo destinatario v√°lido.
- Haz clic en `‚ÄúProbar configuraci√≥n‚Äù`.

![05.png](assets/section-06/05.png)

4. Si la prueba es exitosa, aparecer√° el mensaje: `Email was successfully sent`. Y recibir√°s un correo con un mensaje de
   prueba:

![06.png](assets/section-06/06.png)

‚úÖ Resultado esperado:
> El correo de prueba llega correctamente, confirmando que `Jenkins` puede conectarse con el servidor `SMTP` de `Gmail`.

### ‚úâÔ∏è Configurar Extended E-mail Notification (Email-ext)

Para aprovechar las capacidades avanzadas del plugin `Email Extension Plugin`, configuramos su secci√≥n espec√≠fica:

1. En la misma p√°gina de configuraci√≥n del sistema, busca `‚ÄúExtended E-mail Notification‚Äù` y agrega el `SMTP Server` y
   `SMTP Port`.

![07.png](assets/section-06/07.png)

2. Haz clic en `Add` ‚Üí `Jenkins` para agregar nuevas credenciales.

![08.png](assets/section-06/08.png)

3. Completa los campos:

- `Username`: tu correo de Gmail.
- `Password`: la contrase√±a de aplicaci√≥n generada.
- Luego selecciona la credencial creada en el campo `Credentials`.
- Marca la opci√≥n `Use SSL`.

![09.png](assets/section-06/09.png)

4. Configura los `triggers` predeterminados (cu√°ndo se enviar√°n las notificaciones):

- üü° Before Build
- üî¥ Failure - Any
- üü¢ Success

![10.png](assets/section-06/10.png)

5. Finalmente, haz clic en `Save` para guardar los cambios.

### üë• Agregar destinatarios en un Job espec√≠fico

1. Abre tu Job (por ejemplo, `Primer Job del Curso`), seleccionamos `configurar`.

![11.png](assets/section-06/11.png)

2. Nos vamos a la parte inferior en el apartado `Acciones para ejecutar despu√©s`. En el desplegable seleccionamos la
   acci√≥n `Editable Email Notification`.

![12.png](assets/section-06/12.png)

3. En el campo de destinatarios, agrega los correos a los que Jenkins enviar√° las notificaciones.

![13.png](assets/section-06/13.png)

4. Guarda los cambios con `Apply` ‚Üí `Save`.

### üß™ Prueba de env√≠o de notificaciones

1. Ejecuta el Job haciendo clic en `‚ÄúConstruir ahora‚Äù`.

![14.png](assets/section-06/14.png)

2. En la consola de salida, deber√≠as ver mensajes como los siguientes:

````bash
Email was triggered for: Before Build
Sending email for trigger: Before Build
Sending email to: magadiflo@gmail.com
Email was triggered for: Success
Sending email for trigger: Success 
````

![15.png](assets/section-06/15.png)

3. Revisa tu bandeja de entrada: deber√≠as recibir un correo con un asunto similar a:
   `‚ÄúPrimer Job del Curso - Build #11 - Building!‚Äù`

![16.png](assets/section-06/16.png)

4. Al hacer clic en el enlace del mensaje, ser√°s redirigido a Jenkins para visualizar el estado del Job.

![17.png](assets/section-06/17.png)

### üß† Conclusi√≥n

Has configurado exitosamente la integraci√≥n de `Jenkins con Gmail`, lo que permite que tu servidor notifique
autom√°ticamente los resultados de cada ejecuci√≥n. Esta funcionalidad es fundamental en entornos de integraci√≥n continua,
ya que:

- Permite detectar fallas de forma temprana.
- Facilita la colaboraci√≥n entre equipos.
- Mejora la observabilidad del pipeline.

üí° En entornos empresariales:
> En lugar de Gmail, se suele integrar Jenkins con servidores corporativos SMTP (como Microsoft Exchange, AWS SES o
> SendGrid) para tener mayor control, trazabilidad y cumplimiento de pol√≠ticas de seguridad.

## üíº Integraci√≥n de Jenkins con Slack

El objetivo de esta lecci√≥n es permitir que Jenkins pueda enviar mensajes autom√°ticos ante eventos relevantes,
como fallos de compilaci√≥n o ejecuciones exitosas a Slack.

### üîå Agregando Plugin de Slack en Jenkins

Nos vamos a `Administrar Jenkins` -> `Plugins` -> `Available plugins` y buscamos el plugin `Slack Notification`.

![18.png](assets/section-06/18.png)

Luego de dar en `Install` nos mostrar√° una p√°gina donde aparecer√° el progreso de instalaci√≥n. En esa misma p√°gina
marcamos la casilla `Reiniciar Jenkins cuando termine la instalaci√≥n y no queden trabajos en ejecuci√≥n`.

![19.png](assets/section-06/19.png)

Luego de finalizada la instalaci√≥n, vemos que nuestro plugin ya se encuentra instalado y esta vez est√° en la secci√≥n
`Installed plugins`.

![20.png](assets/section-06/20.png)

### Iniciando Sesi√≥n con Slack y Creando un espacio de trabajo

Nos vamos a la siguiente direcci√≥n de Slack: https://slack.com/intl/es-pe y damos clic en `COMENZAR`.

![21.png](assets/section-06/21.png)

En la p√°gina que se nos abre seleccionamos nuestra cuenta de `GMAIL` para iniciar sesi√≥n. Luego, en la siguiente p√°gina
damos clic en `Crear un espacio de trabajo`.

![22.png](assets/section-06/22.png)

En la siguiente p√°gina nos pregunta ¬øC√≥mo se llama nuestra empresa o equipo?, nosotros le ponemos `Jenkins Guide`. Este
nombre nos permite identificar nuestro espacio de trabajo.

![23.png](assets/section-06/23.png)

Seguimos avanzando hasta la siguiente p√°gina donde damos en `Omitir este paso`

![24.png](assets/section-06/24.png)

En la siguiente p√°gina seleccionamos la versi√≥n limitada gratuita.

![25.png](assets/section-06/25.png)

### Creando un nuevo canal

En el espacio de trabajo `Jenkins Guide`, creamos un nuevo canal llamado `alertas-jenkins`.

![26.png](assets/section-06/26.png)

Luego de crear el canal `alertas-jenkins` tendremos un chat especial para dicho canal.

![27.png](assets/section-06/27.png)

### Agregar integraci√≥n de Slack con Jenkins

En la p√°gina de Slack vamos nuestro espacio de trabajo `Jenkins Guide` > `Herramientas y ajustes` >
`Administrar aplicaciones`.

![28.png](assets/section-06/28.png)

En la siguiente p√°gina que se nos abre, buscamos `Jenkins CI` y lo seleccionamos.

![29.png](assets/section-06/29.png)

Procedemos a `Agregar a Slack`.

![30.png](assets/section-06/30.png)

En la siguiente ventana seleccionamos el canal que creamos anteriormente `#alertas-jenkins` y damos en
`Agregar Integraci√≥n con Jenkins CI`.

![31.png](assets/section-06/31.png)

En la siguiente p√°gina nos mostrar√° los pasos para integrar nuestro jenkins con slack. En este punto el paso que m√°s
nos interesa es el `Paso 3`, dado que aqu√≠ tiene datos que nos permitir√° hacer esa integraci√≥n.

![32.png](assets/section-06/32.png)

### Configurar en Jenkins integraci√≥n de Slack

Si nos vamos a `Administrar Jenkins` > `System` y vamos al final de la p√°gina podremos ver la secci√≥n de `Slack`.

![33.png](assets/section-06/33.png)

En esta secci√≥n de `Slack` procederemos a configurar con los datos proporcionados en el `Paso 3`.

- En el `Workspace` agregamos el valor proporcionado en `Team Subdomain`: `jenkinsguide`.
- En `Kind` seleccionamos `Secret text`.
- En Secret colocamos el valor proporcionado en `Integration Token Credential ID`:
  `9Sofoqnlv4k8pQ6X9dfBgN24nlv4k8pQ6X9dfBgN24`
- En ID, le agregamos un identificador √∫nico que nos permitir√° identificar las credenciales en trabajos y otras
  configuraciones: `credentials-jenkins-guide`.

![34.png](assets/section-06/34.png)

Luego de completar todos los campos requeridos damos en `Test Connection` y vemos que nos muestra `Success`.

![35.png](assets/section-06/35.png)

Luego de dar en el bot√≥n `Save` nos vamos a la p√°gina de `Slack` y vemos que nos ha llegado un mensaje a nuestro canal
configurado: `Slack/Jenkins plugin: you're all set on http://localhost:8080/`.

![36.png](assets/section-06/36.png)

### Probando integraci√≥n de Jenkins con Slack

Nos vamos al `Job Parametrizado 1` y en el apartado de `Build Steps` deliberadamente provocaremos un error, en vez de
`echo` lo dejaremos como `cho`, es decir es un comando que no existe as√≠ que debe provocar un error.

![37.png](assets/section-06/37.png)

Luego, en la parte final `Acciones para ejecutar despu√©s` vamos a `A√±adir una acci√≥n` y seleccionamos
`Slack Notifications`.

![38.png](assets/section-06/38.png)

Luego seleccionamos, para este ejemplo, que nos notifique cuando ocurre un fallo o cuando todo vuelve a la normalidad.

![39.png](assets/section-06/39.png)

Procedemos a construir el `Job Parametrizado 1` y como era de esperarse falla la construcci√≥n.

![40.png](assets/section-06/40.png)

Ahora, si regresamos a nuestro canal de `Slack`, vemos que nos ha llegado un mensaje con el fallo:
`Job Parametrizado 1 - #3 Failure after 8.8 sec (Open)`

![41.png](assets/section-06/41.png)

Procedemos a arreglar el error y volvemos a construir el Job. Esta vez todo se construye correctamente.

![42.png](assets/section-06/42.png)

Finalmente, revisamos nuestra canal de `Slack` y vemos que nos ha llegado la notificaci√≥n de que todo est√° funcionando
con normalidad: `Job Parametrizado 1 - #4 Back to normal after 5 min 16 sec (Open)`.

![43.png](assets/section-06/43.png)
