# âš™ï¸ Parametrizando Jenkins Jobs

---

## ðŸ§© Agregando parÃ¡metros

Iniciamos creando una `nueva vista`. La opciÃ³n `"Nueva vista" (New View)` en el panel principal de `Jenkins` sirve para
*crear una pÃ¡gina personalizada que agrupa y muestra un subconjunto especÃ­fico de tus trabajos (`Jobs`).*

ðŸ’¡ Concepto clave:
> Una vista es una forma de `organizar y filtrar proyectos`, ideal cuando tienes muchos `Jobs` y deseas agruparlos
> segÃºn un equipo, propÃ³sito o entorno especÃ­fico.

### âž• CreaciÃ³n de la vista

Damos clic en el Ã­cono del mÃ¡s `(+)`.

![01.jpg](assets/section-05/01.png)

Asignamos un nombre â€”por ejemploâ€” `Jobs Parametrizados`. En la secciÃ³n `Type` se nos presentan dos opciones:

- ðŸ§¾ `Lista de vistas`: muestra proyectos en formato de lista.
- ðŸ”’ `Mi vista`: muestra tareas a las que el usuario tiene acceso directo.

Seleccionamos `Lista de vistas` y presionamos `Create`.

![02.png](assets/section-05/02.png)

Agregamos una pequeÃ±a descripciÃ³n a nuestra vista y damos clic en `Save`.

![03.png](assets/section-05/03.png)

A continuaciÃ³n veremos nuestra vista reciÃ©n creada `Jobs Parametrizados`, donde agruparemos los distintos `Jobs` que
configuraremos en esta secciÃ³n.

![04.png](assets/section-05/04.png)

ðŸ’¡ Nota:
> `Jenkins` crea automÃ¡ticamente la vista `Todo (All)` donde se listan todos los `Jobs del sistema`. En cambio,
> en nuestra nueva vista solo aparecerÃ¡n los `Jobs` que agreguemos manualmente.

![05.png](assets/section-05/05.png)

### ðŸ§± Creando un nuevo Job parametrizado

Con la vista `Jobs Parametrizados` seleccionada, damos clic en `Nueva tarea`.

![06.png](assets/section-05/06.png)

Le asignamos el nombre `Job Parametrizado 1`, elegimos `Crear un proyecto de estilo libre`, y verificamos que el
check `Add to current view` estÃ© activado, para aÃ±adirlo a la vista actual.

![07.png](assets/section-05/07.png)

### ðŸ§¹ ConfiguraciÃ³n bÃ¡sica de mantenimiento

Habilitamos la opciÃ³n `Desechar ejecuciones antiguas`, que controla la `retenciÃ³n de logs`, `artefactos` y
`metadatos` de compilaciones pasadas.

Podemos definir los criterios de eliminaciÃ³n usando:

- â³ `Build age`: descarta compilaciones despuÃ©s de cierta antigÃ¼edad (por ejemplo, 7 dÃ­as).
- ðŸ”¢ `Build count`: mantiene un nÃºmero mÃ¡ximo de compilaciones (por ejemplo, 50).

En nuestro caso:

- **NÃºmero de dÃ­as para mantener ejecuciones:** 5
- **NÃºmero mÃ¡ximo de ejecuciones:** 6

![08.png](assets/section-05/08.png)

### ðŸ’» AÃ±adiendo un paso de construcciÃ³n

En la secciÃ³n `Build Steps`, seleccionamos la opciÃ³n `Ejecutar lÃ­nea de comandos (shell)`.

![09.png](assets/section-05/09.png)

### ðŸ“œ Creando el script `params_script.sh`

Antes de mostrar la vista `Ejecutar linea de comandos (shell)` vamos a crear un nuevo script en este proyecto llamado
`params_script.sh`. Como observamos, este script no tiene las variables `NAME` ni `COURSE` inicializadas, dado que
se espera que estas variables estÃ©n disponibles en el entorno de Jenkins cuando los agreguemos a travÃ©s de su interfaz.

````bash
#!/bin/bash

# --------------------------------------------------------------------------------------
# Este script NO declara las variables NAME y COURSE internamente.
#
# La razÃ³n es que este script estÃ¡ diseÃ±ado para ser ejecutado como un paso
# de 'Execute shell' en un Job de Jenkins configurado como Parametrizado.
#
# Jenkins inyectarÃ¡ automÃ¡ticamente los valores para las variables de entorno
# $NAME y $COURSE (definidas en la configuraciÃ³n del Job) antes de ejecutar el script.
#
# Al no redefinirlas aquÃ­, se garantiza que los valores pasados desde la interfaz
# de usuario de Jenkins son los que se utilizarÃ¡n durante la ejecuciÃ³n.
# --------------------------------------------------------------------------------------

# Empieza el loop
for i in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
do
	# Si i = 8, el loop se detiene momentÃ¡neamente
    if [ ${i} -eq 8 ]; then
    	# Dormir 5 segundos
        sleep 5
        echo "A descansar de clase ${COURSE}"
    fi
    echo "Clase NÂ° ${i}"
done

# Dormir 5 segundos
sleep 5
echo "Bien ${NAME}, terminamos las clases de ${COURSE}, Â¡nos vemos!"
````

ðŸ“‚ Copiamos el script dentro del contenedor de `Jenkins`.

````bash
D:\programming\jenkins\jenkins-guide (section-05)
$ docker container cp .\scripts\params_script.sh c-jenkins:/opt
Successfully copied 3.07kB to c-jenkins:/opt
````

Podemos ejecutar el siguiente comando para ver el contendio del archivo `params_script.sh` dentro del contenedor de
jenkins.

````bash
$ docker container exec c-jenkins cat /opt/params_script.sh
#!/bin/bash

# --------------------------------------------------------------------------------------
# Este script NO declara las variables NAME y COURSE internamente.
#
# La razÃ³n es que este script estÃ¡ diseÃ±ado para ser ejecutado como un paso
# de 'Execute shell' en un Job de Jenkins configurado como Parametrizado.
#
# Jenkins inyectarÃ¡ automÃ¡ticamente los valores para las variables de entorno
# $NAME y $COURSE (definidas en la configuraciÃ³n del Job) antes de ejecutar el script.
#
# Al no redefinirlas aquÃ­, se garantiza que los valores pasados desde la interfaz
# de usuario de Jenkins son los que se utilizarÃ¡n durante la ejecuciÃ³n.
# --------------------------------------------------------------------------------------

# Empieza el loop
for i in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
do
        # Si i = 8, el loop se detiene momentÃ¡neamente
    if [ ${i} -eq 8 ]; then
        # Dormir 5 segundos
        sleep 5
        echo "A descansar de clase ${COURSE}"
    fi
    echo "Clase NÂ° ${i}"
done

# Dormir 5 segundos
sleep 5
echo "Bien ${NAME}, terminamos las clases de ${COURSE}, Â¡nos vemos!" 
````

### âš™ï¸ Configurando la ejecuciÃ³n en Jenkins

En el campo de `Ejecutar linea de comandos (shell)`, escribimos la ruta al script dentro del contenedor:
`/opt/params_script.sh`.

![10.png](assets/section-05/10.png)

### ðŸ§  Habilitando la parametrizaciÃ³n del Job

Marcamos la opciÃ³n `Esta ejecuciÃ³n debe parametrizarse` y aÃ±adimos parÃ¡metros de cadena (String parameters) para las
variables esperadas: `NAME` y `COURSE`.

![11.png](assets/section-05/11.png)

Definimos cada parÃ¡metro con su valor predeterminado:

- `NAME` = Milagros
- `COURSE` = La GuÃ­a de Jenkins

![12.png](assets/section-05/12.png)

![13.png](assets/section-05/13.png)

### ðŸš€ Ejecutando el Job parametrizado

Al guardar la configuraciÃ³n, se habilita la opciÃ³n `Build with Parameters`. AllÃ­ podemos ajustar los valores de `NAME`
y `COURSE` antes de ejecutar. En nuestro caso ejecutamos con los valores por defecto:

![14.png](assets/section-05/14.png)

Finalmente, abrimos el `Console Output` y observamos cÃ³mo `Jenkins` interpreta y usa los valores inyectados.

![15.png](assets/section-05/15.png)

ðŸ’¡ Resultado esperado:
> El script imprime las iteraciones del bucle, realiza una pausa intermedia y muestra los mensajes personalizados con
> los valores definidos.

### ðŸ§­ ConclusiÃ³n

En esta lecciÃ³n aprendimos a:

- Organizar Jobs mediante `vistas personalizadas`.
- Crear un `Job parametrizado` con variables de entorno inyectadas desde `Jenkins`.
- Ejecutar scripts externos y observar cÃ³mo Jenkins pasa dinÃ¡micamente los parÃ¡metros definidos por el usuario.

## ðŸŽ›ï¸ ParÃ¡metro de elecciÃ³n en Jenkins

### ðŸ§© Modificando el Job parametrizado

En esta lecciÃ³n continuamos trabajando con el `Job parametrizado 1`, pero ahora introduciremos un nuevo tipo de
parÃ¡metro: `â€œParÃ¡metro de elecciÃ³nâ€` (Choice Parameter).

Primero, abrimos el job y seleccionamos `Configurar â†’ Build Steps`.

ðŸ’¡ Recordatorio:
> Anteriormente, habÃ­amos definido en la secciÃ³n `Ejecutar lÃ­nea de comandos (shell)` la ruta del script parametrizado:
> `/opt/params_script.sh`

### âœï¸ Incorporando nuevas variables

Esta vez copiaremos el contenido de ese script directamente dentro del campo de comandos de `Jenkins`, y ademÃ¡s
agregaremos una nueva variable llamada `LANGUAGE`.

![16.png](assets/section-05/16.png)

### ðŸ§± Redefiniendo parÃ¡metros

Subimos hacia la parte superior del formulario y en la secciÃ³n `â€œEsta ejecuciÃ³n debe parametrizarseâ€` haremos los
siguientes ajustes:

- âŒ Eliminamos el parÃ¡metro anterior `COURSE`.
- âž• Lo volvemos a aÃ±adir, pero ahora seleccionamos el tipo `â€œElecciÃ³nâ€` (Choice Parameter).

![17.png](assets/section-05/17.png)

### ðŸ§® Definiendo opciones de elecciÃ³n

Volvemos a escribir el nombre de la variable `COURSE`, y en el campo de opciones listamos los valores posibles que el
usuario podrÃ¡ seleccionar antes de ejecutar el `Job`.

![18.png](assets/section-05/18.png)

Hacemos lo mismo para la nueva variable `LANGUAGE`, tambiÃ©n usando un parÃ¡metro de tipo `ElecciÃ³n`.

![19.png](assets/section-05/19.png)

ðŸ’¡ Ventaja:
> Los `Choice Parameters` son Ãºtiles cuando queremos limitar las opciones de entrada y garantizar que el usuario
> seleccione solo valores vÃ¡lidos, evitando errores por texto libre.

### ðŸš€ Ejecutando el Job con parÃ¡metros de elecciÃ³n

Guardamos los cambios y presionamos `Build with Parameters`. La vista lateral derecha mostrarÃ¡ las variables
configuradas, pero ahora con listas desplegables para `COURSE` y `LANGUAGE`.

![20.png](assets/section-05/20.png)

ðŸ”½ Como observamos, ya no podemos escribir los valores manualmente; debemos seleccionarlos desde las opciones definidas.

### ðŸ§¾ Verificando la salida

Ejecutamos el Job y revisamos el resultado en la pestaÃ±a `Console Output`.

![21.png](assets/section-05/21.png)

Podemos confirmar que los valores seleccionados en los desplegables de `COURSE` y `LANGUAGE` fueron inyectados
correctamente en la ejecuciÃ³n del script y se muestran en la salida de consola.
