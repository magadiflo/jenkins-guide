# üöÄ Secci√≥n 12: Jenkins Job DSL

---

## üß© Introducci√≥n al Job DSL

El t√©rmino `DSL (Domain Specific Language)` hace referencia a un lenguaje dise√±ado para resolver problemas dentro
de un dominio espec√≠fico. En el caso de `Jenkins`, el `Job DSL` permite
`definir, crear y actualizar jobs usando c√≥digo`, en lugar de configurarlos manualmente desde la interfaz web.

Esto es especialmente √∫til en empresas donde se requiere:

- Est√°ndares de configuraci√≥n entre cientos de jobs.
- Versionar pipelines y plantillas.
- Automatizar despliegues de la infraestructura de CI/CD.

### üõ†Ô∏è ¬øQu√© es el plugin Jenkins Job DSL?

El plugin `Jenkins Job DSL` permite generar jobs mediante archivos escritos en `Groovy` (*`Groovy` es un lenguaje de
scripting din√°mico para la plataforma Java*). Con este plugin podemos
escribir c√≥digo que describa:

- Freestyle jobs
- Pipeline jobs
- Vistas
- Carpetas
- Configuraciones completas de la interfaz

De esta manera, Jenkins se convierte en un sistema declarativo, donde el c√≥digo es la fuente de verdad para los jobs.

> üí° Para poder usar `Job DSL` es indispensable instalar el plugin oficial: `Job DSL Plugin`

### üßµ ¬øPor qu√© usar Job DSL? (Beneficios Reales)

Los usuarios pueden describir sus jobs mediante scripts basados en `Groovy`, lo que habilita ventajas muy alineadas con
las pr√°cticas modernas de CI/CD:

#### ‚úîÔ∏è Rollbacks seguros

Puedes revertir un cambio en un job simplemente regresando a una versi√≥n anterior del script en Git.

#### ‚úîÔ∏è Historial de cambios y auditor√≠a

Cada modificaci√≥n a un job queda registrada en el control de versiones (Git), no solo en la UI de Jenkins.

#### ‚úîÔ∏è Control de versiones

Los jobs pasan a ser infraestructura como c√≥digo (IaC), facilitando:

- Revisiones por PR
- Control de calidad en cambios de pipelines
- Despliegue consistente de jobs en distintos entornos (Dev, QA, Prod)

#### ‚úîÔ∏è Automatizaci√≥n completa

Puedes crear cientos de jobs autom√°ticamente a partir de una plantilla.

### üè¢ ¬øC√≥mo se usa en empresas reales?

En el mundo profesional, `Job DSL` se emplea para:

- Definir plantillas estandarizadas para equipos completos.
- Crear jobs autom√°ticamente para nuevos repositorios.
- Evitar configuraciones manuales que producen errores humanos.
- Mantener versiones claras de los pipelines (GitOps + CI/CD).
- Generar m√∫ltiples pipelines basados en par√°metros (ej: microservicios).
- Reducir inconsistencias entre entornos o equipos.

üí° En entornos empresariales grandes, `Job DSL` convive con `Jenkins Pipeline` (declarativo o scripted).
Suele usarse as√≠:

| Uso                         | Herramienta      |
|-----------------------------|------------------|
| Crear la estructura del job | Job DSL          |
| Ejecutar el pipeline real   | Jenkins Pipeline |

## ‚öôÔ∏è Instalaci√≥n del Plugin Job DSL

Para utilizar `Job DSL` en `Jenkins`, primero debemos instalar el plugin oficial. Este plugin nos permitir√° definir
jobs mediante c√≥digo `Groovy` y habilita las herramientas necesarias para generar, actualizar y gestionar
configuraciones desde scripts.

Nos vamos a `Administrar Jenkins` ‚Üí `Plugins` y buscamos `Job DSL`, lo seleccionamos y procedemos a instalar.

![01.png](assets/section-12/01.png)

Seleccionamos `Reiniciar Jenkins cuando termina la instalaci√≥n...` y esperamos mientras se instala.

![02.png](assets/section-12/02.png)

## üå± Seed Job & Description (Fundamentos del Job DSL)

Para utilizar correctamente el `Plugin Job DSL`, lo primero que debemos crear es un `Seed Job`.

Un `Seed Job` es un job normal de Jenkins (igual que los jobs de estilo libre que hemos estado creando), pero con
la particularidad de que incluye el paso `Process Job DSLs`. Este paso le permite ejecutar
`scripts DSL escritos en Groovy` para crear o actualizar otros jobs autom√°ticamente. A partir de estos scripts es
posible:

- Crear nuevos jobs.
- Actualizar configuraciones.
- Regenerar plantillas.
- Aplicar cambios en masa.

En otras palabras:

> üß† El `Seed Job` es el `‚Äújob padre‚Äù` que genera otros jobs autom√°ticamente mediante c√≥digo.

### üîç ¬øPor qu√© existe el Seed Job?

Porque `Jenkins`, por defecto, solo ejecuta lo que le asignamos manualmente. El `Seed Job` act√∫a como
‚Äúint√©rprete‚Äù del DSL, permitiendo:

- Automatizar creaci√≥n de pipelines.
- Mantener jobs versionados.
- Facilitar la estandarizaci√≥n en equipos grandes.
- Evitar configuraciones manuales desde la UI.
- Regenerar jobs cuando cambian las plantillas.

> üí° En empresas, los `Seed Jobs` suelen correr autom√°ticamente al recibir cambios en su repositorio Git.

### üõ†Ô∏è Crear el Seed Job y configurar el DSL

Creamos un job de estilo libre llamado: `dsl-job`. Este ser√° nuestro `Seed Job` inicial.

![03.png](assets/section-12/03.png)

Dentro del job, nos dirigimos al `Build Steps` y en `+ A√±adir un nuevo paso` seleccionamos `Process Job DSLs`.

![04.png](assets/section-12/04.png)

### üìÅ Opciones del procesamiento DSL

Al agregar el paso, aparecen dos opciones:

- üî∏ Opci√≥n 1: `Use the provided DSL script`.
    - Permite escribir el c√≥digo directamente en la interfaz del job.
    - Suele usarse solo para pruebas o demos.

- üî∏ Opci√≥n 2: `Look on Filesystem`
    - Permite cargar uno o varios archivos `.groovy` desde el workspace del job.
    - Esta es la forma usada en empresas, pues el DSL se versiona en Git.

En este punto usaremos la `opci√≥n 1` para una demostraci√≥n.

![05.png](assets/section-12/05.png)

### üìù Ejemplo b√°sico de DSL Script

Al seleccionar la `opci√≥n 1`, aparece un cuadro de texto para escribir el script. Usaremos este ejemplo simple:

````bash
job('ejemplo-job-DSL') {
  
}
````

Este script indica:

> üî® Crear un nuevo job llamado `ejemplo-job-DSL` utilizando como base este seed job (`dsl-job`).

Nota:
> En el siguiente enlace https://jenkinsci.github.io/job-dsl-plugin podemos ver informaci√≥n sobre `Jenkins Job DSL API`


![06.png](assets/section-12/06.png)

### ‚ñ∂Ô∏è Ejecutando el Job DSL

Guardamos el Seed Job y luego hacemos clic en: `Construir Ahora`. Sin embargo, veremos que aparece un error:

![07.png](assets/section-12/07.png)

### üõ°Ô∏è ¬øPor qu√© aparece el error?

Porque `Jenkins`, por seguridad, `no ejecuta scripts Groovy no aprobados`. `Jenkins` requiere revisar los scripts
para evitar ejecuci√≥n de c√≥digo potencialmente peligroso.

Debemos aprobarlos manualmente:

````
Administrar Jenkins ‚Üí In-process Script Approval 
````

![08.png](assets/section-12/08.png)

### ‚úîÔ∏è Aprobando el script

Entramos a `In-Process Script Approval` y hacemos clic en: `Approve`.

![09.png](assets/section-12/09.png)

Despu√©s de aprobarlo, volvemos a ejecutar el Seed Job y veremos que ahora el build finaliza correctamente:

![10.png](assets/section-12/10.png)

### üéâ Verificando que el job fue creado

Vamos al panel principal de Jenkins y veremos que se gener√≥ un nuevo job: `ejemplo-job-DSL`.

![11.png](assets/section-12/11.png)

Y si ingresamos al job reci√©n creado, veremos la referencia: `Seed job: dsl-job`. Esto nos confirma que el job fue
creado mediante c√≥digo usando nuestro Seed Job.

![12.png](assets/section-12/12.png)

