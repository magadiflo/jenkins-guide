# ‚öôÔ∏è Secci√≥n 7: Integraci√≥n de Jenkins con una App Java + Maven

---

### üöÄ Objetivo de la secci√≥n

En esta secci√≥n implementaremos un `flujo completo de Integraci√≥n Continua (CI)` utilizando `Jenkins`, una aplicaci√≥n
`Java con Maven` y un repositorio alojado en `GitHub`.

El objetivo es que Jenkins `detecte cambios en el c√≥digo fuente`, descargue autom√°ticamente la √∫ltima versi√≥n,
`compile el proyecto`, `ejecute pruebas unitarias` y `genere artefactos` listos para desplegar.

üí° Concepto clave:

> La `Integraci√≥n Continua (CI)` es una pr√°ctica esencial en `DevOps` que permite detectar errores de integraci√≥n
> de forma temprana, garantizando que el software est√© siempre en un estado funcional y desplegable.

## üîó Flujo general de integraci√≥n continua con Jenkins

A continuaci√≥n, se detalla el flujo de trabajo que implementaremos paso a paso:

1. üîå `Instalaci√≥n de plugins y configuraci√≥n base`. Configuraremos los plugins requeridos por `Maven`, `Git` y
   `GitHub`, as√≠ como las variables necesarias para la ejecuci√≥n del pipeline.
2. ‚¨áÔ∏è `Pull del repositorio GitHub en Jenkins`. Jenkins clonar√° autom√°ticamente el repositorio del proyecto Maven cada
   vez que se detecten nuevos commits.
3. üèóÔ∏è `Construcci√≥n del proyecto con Maven`. Se ejecutar√° el comando `mvn clean install` o equivalente para compilar el
   c√≥digo fuente y generar los artefactos (`.jar` o `.war`).
4. üß™ `Ejecuci√≥n de Pruebas Unitarias con Maven en Jenkins`. Durante el build, Maven ejecutar√° las pruebas definidas con
   JUnit, Mockito, u otros frameworks de testing configurados en el proyecto.
5. ‚ñ∂Ô∏è `Ejecuci√≥n de la aplicaci√≥n`. Finalmente, Jenkins podr√° ejecutar o desplegar la aplicaci√≥n, ya sea localmente o
   en un contenedor Docker, dependiendo del entorno.

### ‚öôÔ∏è Jenkins + GitHub + Maven en acci√≥n

El flujo completo ser√° similar al siguiente:

````
[GitHub Repo] ‚îÄ‚îÄpush‚îÄ‚îÄ‚ñ∂ [Jenkins Job] ‚îÄ‚îÄbuild+test‚îÄ‚îÄ‚ñ∂ [Artefacto Maven listo para despliegue] 
````

Cada cambio en GitHub disparar√° una nueva ejecuci√≥n autom√°tica en Jenkins, garantizando que la aplicaci√≥n Java:

- Compile sin errores.
- Pase las pruebas unitarias.
- Genere un artefacto v√°lido (por ejemplo, un `.jar` funcional).

## üîå 1. Instalaci√≥n de plugins y configuraci√≥n base

### üß© Instalaci√≥n del plugin `Maven Integration Plugin`

Para comenzar con la integraci√≥n continua usando una aplicaci√≥n Java con Maven, primero debemos instalar el plugin que
permite a `Jenkins` ejecutar `builds Maven`.

1. Ve a: `Administrar Jenkins` ‚Üí `Plugins` ‚Üí `Available plugins`
2. Busca: `Maven Integration`
3. Selecciona el plugin y procede con la instalaci√≥n.

![01.png](assets/section-07/01.png)

Este plugin no solo permite ejecutar builds Maven dentro de Jenkins, sino que adem√°s:

- Integra la fase de build con el ciclo est√°ndar de Jenkins (detecta pom.xml, usa el Maven home configurado en Tools y
  expone pasos Maven en freestyle jobs).
- Permite el seguimiento de artefactos generados, pruebas, reportes y resultados JUnit.
- Facilita la creaci√≥n de proyectos tipo ‚ÄúMaven project‚Äù (si no se usa Pipeline).

> üí° `Nota`: aunque hoy en d√≠a casi todo se implementa con Pipelines (Jenkinsfile), muchos plugins heredados siguen
> dependiendo de esta integraci√≥n para reportes de pruebas, cobertura, etc.

En la siguiente pantalla se mostrar√° el progreso de instalaci√≥n. Es recomendable marcar la opci√≥n
`‚ÄúReiniciar Jenkins cuando finalice la instalaci√≥n‚Äù` para completar la configuraci√≥n.

![02.png](assets/section-07/02.png)

Una vez reiniciado `Jenkins`, verifica que el plugin haya sido instalado correctamente:

- Navega a: `Installed plugins`
- Busca nuevamente `Maven`
- Deber√°s ver `Maven Integration Plugin` en la lista

![03.png](assets/section-07/03.png)

### üß© Verificaci√≥n de `GitHub Branch Source Plugin`

El plugin `GitHub Branch Source Plugin` viene instalado por defecto en la mayor√≠a de distribuciones modernas de
`Jenkins`. No es necesario instalarlo manualmente, solo comprobar que est√© disponible.

![04.png](assets/section-07/04.png)

Este plugin hace mucho detr√°s de c√°maras para que la integraci√≥n `Jenkins‚ÄìGitHub` sea moderna y autom√°tica:

- Detectar ramas y pull requests (PRs) din√°micamente usando la API de GitHub.
- Configura autom√°ticamente Webhooks para que GitHub notifique a Jenkins de nuevos commits.
- Administra credenciales y conexiones a GitHub usando la integraci√≥n con GitHub App o tokens personales.
- Crea y actualiza jobs de manera autom√°tica en un Multibranch Pipeline basados en el Jenkinsfile de cada rama.

> üí° Esto lo vuelve ideal para equipos que usan GitHub Flow o GitHub PR Flow, ya que Jenkins se adapta a los repos sin
> necesidad de crear jobs manuales.

### üõ†Ô∏è Configuraci√≥n de Maven dentro de Jenkins

Ahora que el plugin est√° instalado, debemos configurar `Maven` como herramienta global dentro de `Jenkins` para que
pueda usarse en cualquier `Job` o `Pipeline`.

1. Ir a: `Administrar Jenkins` ‚Üí `Tools`
2. Despl√°zate hacia el final hasta la secci√≥n `Instalaciones de Maven`
3. Haz clic en `+ A√±adir Maven`

![05.png](assets/section-07/05.png)

Completa los siguientes campos:

- Name: `Maven en Jenkins`
- Instalar autom√°ticamente: ‚úîÔ∏è `activado`
- Version: dejar la predeterminada (Jenkins descargar√° la versi√≥n estable recomendada)

![06.png](assets/section-07/06.png)

Finalmente, haz clic en `Save`.

### ‚öôÔ∏è Explicaci√≥n t√©cnica

- `‚ÄúInstalar autom√°ticamente‚Äù` permite que `Jenkins` descargue y mantenga la versi√≥n configurada de `Maven` sin
  necesidad de instalarla manualmente en el servidor.
- En entornos corporativos, es com√∫n:
    - Definir versiones espec√≠ficas de Maven.
    - Instalar Maven en un directorio controlado.
    - Apuntar Jenkins a esa instalaci√≥n para mantener consistencia entre entornos.

üí° Buena pr√°ctica:
> Define versiones fijas de herramientas (como `Maven` y `JDK`) para evitar inconsistencias entre builds generados en
> distintos momentos.

## ‚¨áÔ∏è 2. Pull del repositorio GitHub en Jenkins

En este apartado trabajaremos con el repositorio:

- [macloujulian/simple-java-maven-app](https://github.com/macloujulian/simple-java-maven-app) ‚Üí fork del repositorio
  oficial:
- [jenkins-docs/simple-java-maven-app](https://github.com/jenkins-docs/simple-java-maven-app)

üìå Este proyecto es perfecto para practicar CI porque contiene un `pom.xml`, c√≥digo Java y m√∫ltiples ejemplos de
`Jenkinsfile`, aunque lo del `Jenkinsfile` lo veremos en secciones m√°s adelante.

### üîé ¬øQu√© significa hacer un fork en GitHub?

Un `fork` es una copia completa de un repositorio que pasa a tu propia cuenta de `GitHub`.
Se utiliza t√≠picamente para:

- Crear tu propia versi√≥n de un proyecto.
- Probar cambios sin modificar el repo original.
- Enviar pull requests al repositorio padre.

En el mundo real es com√∫n que empresas forkeen repos open-source para agregarlos a su pipeline, parchearlos o
personalizarlos.

### üìù Repositorio con el que trabajaremos

![07.png](assets/section-07/07.png)

### üÜï Crear un nuevo Job Freestyle

Creamos un job llamado `java_app_con_maven`:

![08.png](assets/section-07/08.png)

### üîó Configuraci√≥n del Origen del C√≥digo Fuente

En la pantalla de configuraci√≥n:

1. Activamos Git en Source Code Management.
2. Indicamos el repositorio: `https://github.com/macloujulian/simple-java-maven-app.git`.
3. En Branch Specifier colocamos la rama: `master`.

> üìå `Nota`: En la mayor√≠a de proyectos modernos se usa `main`; el curso utiliza `master` porque as√≠ est√° configurado
> el repo.

![09.png](assets/section-07/09.png)

### ‚ñ∂Ô∏è Ejecutando el primer build

Damos clic en `Construir ahora` y obtenemos un build exitoso:

![10.png](assets/section-07/10.png)

### üõ†Ô∏è Explicaci√≥n del Console Output (paso a paso y profesional)

Si revisamos el `Console Output`, veremos la siguiente salida:

````bash
Started by user System Admin
Running as SYSTEM
Building in workspace /var/jenkins_home/workspace/java_app_con_maven
The recommended git tool is: NONE
No credentials specified
Cloning the remote Git repository
Cloning repository https://github.com/macloujulian/simple-java-maven-app.git
 > git init /var/jenkins_home/workspace/java_app_con_maven # timeout=10
Fetching upstream changes from https://github.com/macloujulian/simple-java-maven-app.git
 > git --version # timeout=10
 > git --version # 'git version 2.47.3'
 > git fetch --tags --force --progress -- https://github.com/macloujulian/simple-java-maven-app.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git config remote.origin.url https://github.com/macloujulian/simple-java-maven-app.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
Checking out Revision 9396b7c42f467673997e3d5f60b9f460a734e178 (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 9396b7c42f467673997e3d5f60b9f460a734e178 # timeout=10
Commit message: "javamavenDSL3.groovy"
First time build. Skipping changelog.
Finished: SUCCESS 
````

### üîç ¬øPor qu√© no aparece git clone?

`Jenkins` no usa directamente `git clone`. En su lugar realiza una secuencia m√°s controlada:

#### ‚úîÔ∏è Paso 1 ‚Äî Inicializar un repo vac√≠o

````bash
git init /var/jenkins_home/workspace/java_app_con_maven 
````

Crea un repositorio local vac√≠o en el workspace del job.

#### ‚úîÔ∏è Paso 2 ‚Äî Configurar el origen

````bash
git config remote.origin.url <repo-url>
````

Agrega el remoto `origin` apuntando al repositorio de `GitHub`.

#### ‚úîÔ∏è Paso 3 ‚Äî Descarga todas las ramas

````bash
git fetch --tags --force --progress -- <repo-url> +refs/heads/*:refs/remotes/origin/* 
````

`fetch` es m√°s eficiente y m√°s controlable que `git clone`, por eso Jenkins lo usa.

#### ‚úîÔ∏è Paso 4 ‚Äî Resolver el commit a usar

````bash
git rev-parse refs/remotes/origin/master 
````

Identifica el `SHA` exacto que debe construir.

#### ‚úîÔ∏è Paso 5 ‚Äî Hacer checkout del commit

````bash
git checkout -f <sha> 
````

Se mueve la copia de trabajo al commit correcto.

### üí° ¬øPor qu√© Jenkins usa init + fetch + checkout?

Porque:

- Controla exactamente qu√© commit se construye.
- Permite builds reproducibles.
- Evita operaciones innecesarias en cada build.
- Se integra mejor con webhooks, multibranch y PRs.
- Permite comparar cambios entre builds.

En empresas, es la forma est√°ndar: `Jenkins nunca usa ‚Äúgit clone‚Äù directo`.

![11.png](assets/section-07/11.png)

### üìÇ Verificando el proyecto dentro del contenedor

Entramos al contenedor de Jenkins:

````bash
$ docker container exec -it c-jenkins /bin/sh
$ cd /var/jenkins_home/workspace/java_app_con_maven
$ ls -l
total 40
drwxr-xr-x 2 jenkins jenkins 4096 Nov 14 15:57 DSL
-rw-r--r-- 1 jenkins jenkins  111 Nov 14 15:57 Dockerfile
-rw-r--r-- 1 jenkins jenkins  180 Nov 14 15:57 Dockerfile2
-rw-r--r-- 1 jenkins jenkins  578 Nov 14 15:57 Jenkinsfile1
-rw-r--r-- 1 jenkins jenkins 1133 Nov 14 15:57 Jenkinsfile3
-rw-r--r-- 1 jenkins jenkins 1854 Nov 14 15:57 Jenkinsfile4
-rw-r--r-- 1 jenkins jenkins  744 Nov 14 15:57 README.md
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 15:57 jenkins
-rw-r--r-- 1 jenkins jenkins 1383 Nov 14 15:57 pom.xml
drwxr-xr-x 4 jenkins jenkins 4096 Nov 14 15:57 src
$ cd src
$ ls -l
total 8
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 15:57 main
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 15:57 test
````

üìå Aqu√≠ ya podemos ver el `c√≥digo Java`, el `pom.xml` y varios `Jenkinsfiles`.

## üèóÔ∏è 3. Construcci√≥n del proyecto con Maven

Continuamos con el job creado en el apartado anterior: `java_app_con_maven`.

### ‚öôÔ∏è Configuraci√≥n del Build con Maven

Navegamos a: `java_app_con_maven` ‚Üí `Configurar` ‚Üí `Build Steps` ‚Üí `Ejecutar tareas maven de nivel superior`

![12.png](assets/section-07/12.png)

Dentro de este formulario debemos completar los siguientes campos:

- Versi√≥n de Maven: `Maven en Jenkins` (el nombre que asignamos en `Administrar Jenkins` ‚Üí `Tools`)
- Goals: Aunque solemos ejecutar Maven desde consola as√≠:
    ````bash
    mvn -B clean package -DskipTests 
    ````
  En `Jenkins` no debemos anteponer el comando `mvn`, ya que el executor ya sabe que estamos invocando `Maven`. Por lo
  tanto, los goals quedan as√≠:
    ````bash
    -B clean package -DskipTests
    ````

![13.png](assets/section-07/13.png)

**Donde**

- üìå `-B `(Batch Mode). Ejecuta Maven en modo no interactivo. Fundamental en CI/CD porque:
    - evita prompts que bloquear√≠an el pipeline,
    - falla inmediatamente si necesita interacci√≥n,
    - produce logs m√°s lineales.
- üìå `clean`
    - Elimina el directorio `target/`.
    - Garantiza una compilaci√≥n limpia y reproducible.
- üìå `package`
    - Compila y empaqueta la aplicaci√≥n en un artefacto `(JAR/WAR)`.
- üìå `-DskipTests`. Indica a Maven que **omita la ejecuci√≥n de pruebas**. Esto acelera el build, especialmente √∫til en:
    - validaciones r√°pidas
    - pipelines de prueba funcional
    - validaciones previas a PR
- ‚úîÔ∏è Nota real del mundo empresarial
    - En pipelines productivos se suelen usar dos etapas separadas:
    - Build r√°pido (`package -DskipTests`)
    - Etapa exclusiva de tests (`sin skipTests`)

### ‚ñ∂Ô∏è Ejecutando el build

Damos clic en Construir ahora:

![14.png](assets/section-07/14.png)

Al finalizar, revisamos el `Console Output` y vemos:

![15.png](assets/section-07/15.png)

Perfecto, la construcci√≥n de nuestra aplicaci√≥n en un archivo `.jar` se ha realizado con √©xito, pues obtenemos el
mensaje `BUILD SUCCESS`.

![16.png](assets/section-07/16.png)

### üì¶ Verificando el artefacto .jar

Verificamos que el `my-app-1.0-SNAPSHOT.jar` se encuentre en el directorio que muestra la salida de consola del
job de jenkins: `/var/jenkins_home/workspace/java_app_con_maven/target/`.

````bash
$ docker container exec -it c-jenkins /bin/sh
$ cd /var/jenkins_home/workspace/java_app_con_maven/target/
$ ls -l
total 28
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 17:11 classes
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 17:11 generated-sources
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 17:11 generated-test-sources
drwxr-xr-x 2 jenkins jenkins 4096 Nov 14 17:11 maven-archiver
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 17:11 maven-status
-rw-r--r-- 1 jenkins jenkins 2676 Nov 14 17:11 my-app-1.0-SNAPSHOT.jar
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 17:11 test-classes
````

### üì£ Configurando notificaciones por Email y Slack

Es com√∫n en CI/CD configurar alertas para:

- builds fallidos (‚ùå)
- builds que regresan a la normalidad (‚úÖ)

Esto permite a los equipos reaccionar r√°pido ante fallas. Configuramos notificaciones dentro del job:

![17.png](assets/section-07/17.png)

Y agregamos tambi√©n notificaciones Slack:

![18.png](assets/section-07/18.png)

### üß™ Probando las notificaciones (fallo intencional)

Para verificar que las alertas funcionan, introducimos un error:

Cambiamos el goal:

- ‚ùå `package`
- ‚úîÔ∏è lo reemplazamos por `packag`

![19.png](assets/section-07/19.png)

Construimos nuevamente y, como se espera, el build falla:

![20.png](assets/section-07/20.png)

En el `Console Output` vemos que Jenkins envi√≥ notificaciones:

![21.png](assets/section-07/21.png)

### üì¨ Email recibido

![22.png](assets/section-07/22.png)

### üí¨ Notificaci√≥n Slack

![23.png](assets/section-07/23.png)

## üß™ 4. Ejecuci√≥n de Pruebas Unitarias con Maven en Jenkins

En esta secci√≥n validaremos que nuestra aplicaci√≥n Java funcione correctamente ejecutando sus `pruebas unitarias`
desde `Jenkins`.

En un proyecto Maven, las pruebas se ejecutan con el comando:

````bash
mvn test 
````

Sin embargo, cuando trabajamos con el paso nativo `‚ÄúEjecutar tareas 'maven' de nivel superior‚Äù`, `Jenkins` ya conoce la
instalaci√≥n de `Maven` configurada previamente, por lo que solo necesitamos escribir el goal (sin el `mvn`):

````bash
test
````

### üèóÔ∏è A√±adiendo el paso de ejecuci√≥n de tests

Ingresamos al job `java_app_con_maven` y en la secci√≥n `Build Steps` agregamos un nuevo paso:

- `+ A√±adir un nuevo paso` ‚Üí `Ejecutar tareas 'maven' de nivel superior`

En el campo Goals, escribimos:

````bash
test 
````

üìå Recordemos que en la lecci√≥n anterior hab√≠amos colocado el `Goal`: `-B clean package -DskipTests`.

![24.png](assets/section-07/24.png)

Ahora construimos el job:

![25.png](assets/section-07/25.png)

### üìã Verificando la ejecuci√≥n en la consola

Luego de construir el job, observamos la salida en el `Console Output`.

![26.png](assets/section-07/26.png)

Para mayor claridad mostraremos la salida completa del `Console Output`. Observemos que `Jenkins` ejecuta:

- `mvn -B clean package -DskipTests`
- `mvn test`

Ambos procesos se completan correctamente:

````bash
Started by user System Admin
Running as SYSTEM
Building in workspace /var/jenkins_home/workspace/java_app_con_maven
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/java_app_con_maven/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/macloujulian/simple-java-maven-app.git # timeout=10
Fetching upstream changes from https://github.com/macloujulian/simple-java-maven-app.git
 > git --version # timeout=10
 > git --version # 'git version 2.47.3'
 > git fetch --tags --force --progress -- https://github.com/macloujulian/simple-java-maven-app.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
Checking out Revision 9396b7c42f467673997e3d5f60b9f460a734e178 (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 9396b7c42f467673997e3d5f60b9f460a734e178 # timeout=10
Commit message: "javamavenDSL3.groovy"
 > git rev-list --no-walk 9396b7c42f467673997e3d5f60b9f460a734e178 # timeout=10
[java_app_con_maven] $ /var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/Maven_en_Jenkins/bin/mvn -B clean package -DskipTests
[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------------< com.mycompany.app:my-app >----------------------
[INFO] Building my-app 1.0-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- clean:3.2.0:clean (default-clean) @ my-app ---
[INFO] Deleting /var/jenkins_home/workspace/java_app_con_maven/target
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ my-app ---
...
[INFO] 
[INFO] --- surefire:3.2.5:test (default-test) @ my-app ---
[INFO] Tests are skipped.
[INFO] 
[INFO] --- jar:3.0.2:jar (default-jar) @ my-app ---
[INFO] Building jar: /var/jenkins_home/workspace/java_app_con_maven/target/my-app-1.0-SNAPSHOT.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  2.578 s
[INFO] Finished at: 2025-11-15T04:22:45Z
[INFO] ------------------------------------------------------------------------
[java_app_con_maven] $ /var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/Maven_en_Jenkins/bin/mvn test
[INFO] Scanning for projects...
[INFO] 
[INFO] ----------------------< com.mycompany.app:my-app >----------------------
[INFO] Building my-app 1.0-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ my-app ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /var/jenkins_home/workspace/java_app_con_maven/src/main/resources
...
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.mycompany.app.AppTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.042 s -- in com.mycompany.app.AppTest
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  3.014 s
[INFO] Finished at: 2025-11-15T04:22:50Z
[INFO] ------------------------------------------------------------------------
[Slack Notifications] found #4 as previous completed, non-aborted build
Finished: SUCCESS 
````

La salida anterior confirma que las pruebas unitarias de la aplicaci√≥n se ejecutaron sin errores.

### üìä Publicar resultados de pruebas unitarias en Jenkins

Para visualizar los reportes de pruebas directamente en la interfaz de `Jenkins`, a√±adiremos una acci√≥n de publicaci√≥n.

#### üìù Configurar la publicaci√≥n del reporte JUnit

Dentro del job, al final de la configuraci√≥n:

- `+ A√±adir una acci√≥n` ‚Üí `Publicar los resultados de tests JUnit`

![27.png](assets/section-07/27.png)

El plugin necesita la ruta del archivo `.xml` con los resultados generados por `Maven Surefire`. Por defecto, Maven
almacena los reportes de test en:

````bash
target/surefire-reports/ 
````

El archivo real en este proyecto es:

````bash
target/surefire-reports/TEST-com.mycompany.app.AppTest.xml
````

#### üîç Verificaci√≥n dentro del contenedor Jenkins

Confirmamos la existencia del archivo:

````bash
D:\programming\jenkins\jenkins-guide (section-07)
Œª docker container exec -it c-jenkins /bin/sh
$ cd /var/jenkins_home/workspace/java_app_con_maven
$ ls -l
total 44
drwxr-xr-x 2 jenkins jenkins 4096 Nov 14 15:57 DSL
-rw-r--r-- 1 jenkins jenkins  111 Nov 14 15:57 Dockerfile
-rw-r--r-- 1 jenkins jenkins  180 Nov 14 15:57 Dockerfile2
-rw-r--r-- 1 jenkins jenkins  578 Nov 14 15:57 Jenkinsfile1
-rw-r--r-- 1 jenkins jenkins 1133 Nov 14 15:57 Jenkinsfile3
-rw-r--r-- 1 jenkins jenkins 1854 Nov 14 15:57 Jenkinsfile4
-rw-r--r-- 1 jenkins jenkins  744 Nov 14 15:57 README.md
drwxr-xr-x 3 jenkins jenkins 4096 Nov 14 15:57 jenkins
-rw-r--r-- 1 jenkins jenkins 1383 Nov 14 15:57 pom.xml
drwxr-xr-x 4 jenkins jenkins 4096 Nov 14 15:57 src
drwxr-xr-x 9 jenkins jenkins 4096 Nov 15 04:22 target
$ cd target
$ ls -l
total 32
drwxr-xr-x 3 jenkins jenkins 4096 Nov 15 04:22 classes
drwxr-xr-x 3 jenkins jenkins 4096 Nov 15 04:22 generated-sources
drwxr-xr-x 3 jenkins jenkins 4096 Nov 15 04:22 generated-test-sources
drwxr-xr-x 2 jenkins jenkins 4096 Nov 15 04:22 maven-archiver
drwxr-xr-x 3 jenkins jenkins 4096 Nov 15 04:22 maven-status
-rw-r--r-- 1 jenkins jenkins 2676 Nov 15 04:22 my-app-1.0-SNAPSHOT.jar
drwxr-xr-x 2 jenkins jenkins 4096 Nov 15 04:22 surefire-reports
drwxr-xr-x 3 jenkins jenkins 4096 Nov 15 04:22 test-classes
$ cd surefire-reports
$ ls -l
total 12
-rw-r--r-- 1 jenkins jenkins 4717 Nov 15 04:22 TEST-com.mycompany.app.AppTest.xml
-rw-r--r-- 1 jenkins jenkins  300 Nov 15 04:22 com.mycompany.app.AppTest.txt
````

#### üõ†Ô∏è Configuraci√≥n final

En el campo Ficheros XML con los informes de tests, colocamos:

````bash
target/surefire-reports/*.xml 
````

Esto permite que `Jenkins` lea cualquier archivo de reporte generado por `Surefire`.

![28.png](assets/section-07/28.png)

### üìà Visualizando reportes en Jenkins

Construimos nuevamente el job y recargamos la p√°gina. Aparecer√° autom√°ticamente un nuevo panel lateral mostrando:

- N√∫mero de tests ejecutados
- Tasa de fallos
- Historial de builds
- Tendencias de salud del proyecto

![29.png](assets/section-07/29.png)

Ejecutando dos o m√°s builds adicionales, el gr√°fico comenzar√° a completarse:

![30.png](assets/section-07/30.png)

## ‚ñ∂Ô∏è 5. Ejecuci√≥n de la aplicaci√≥n

En este paso ejecutaremos el archivo `.jar` que construimos en las etapas anteriores. Hasta este punto nuestro
pipeline ya:

- ‚úîÔ∏è Descarg√≥ el c√≥digo desde `GitHub`.
- ‚úîÔ∏è Ejecut√≥ los tests unitarios.
- ‚úîÔ∏è Construy√≥ el artefacto Maven `(.jar)`.

Ahora validaremos que la aplicaci√≥n realmente arranca sin errores.

### üèóÔ∏è Agregando el paso de ejecuci√≥n en Jenkins

Debemos agregar un nuevo paso dentro de la secci√≥n de `Build Steps`:

1. Ir al job: `java_app_con_maven` ‚Üí `Configurar`
2. Ubicar la secci√≥n: `Build Steps`
3. Dar clic en: `+ A√±adir un nuevo paso` ‚Üí `Ejecutar l√≠nea de comandos (shell)`

![31.png](assets/section-07/31.png)

Dentro del campo de comandos agregaremos lo siguiente ‚¨áÔ∏è:

````bash
echo "Entrega: Desplegando la aplicaci√≥n"
java -jar /var/jenkins_home/workspace/java_app_con_maven/target/my-app-1.0-SNAPSHOT.jar
````

![32.png](assets/section-07/32.png)

üí° Nota t√©cnica

- `Jenkins` ejecuta el comando **dentro del workspace del job**.
- El `.jar` est√° dentro de `target/`, que es la carpeta est√°ndar de Maven para artefactos construidos.
- Esta ejecuci√≥n `no es un despliegue real`, es solo para validar que la app arranca correctamente. En empresas, esta
  fase se usa como `smoke test` antes de entregar o desplegar el artefacto.

### üöÄ Ejecutando el job

Ahora debemos construir el job manualmente para verificar todo el flujo:

- Clic en `Construir ahora`.

![33.png](assets/section-07/33.png)

Una vez terminado el build, revisamos:

- √öltima ejecuci√≥n
- Console Output

![34.png](assets/section-07/34.png)

Si todo est√° correcto, ver√°s la salida est√°ndar de tu aplicaci√≥n Java. Aqu√≠ Jenkins ya est√° ejecutando tu aplicaci√≥n
real.

## üì¶ Ver la √∫ltima ejecuci√≥n exitosa (Artifact Storage)

En esta parte configuraremos Jenkins para que preserve el `.jar` generado como artefacto. Esto es esencial en CI/CD
porque:

- Permite tener un historial de artefactos construidos.
- Otros Jobs (por ejemplo, despliegue) pueden tomar este archivo.
- Garantiza que siempre se despliega `exactamente lo que se construy√≥`, evitando inconsistencias.

## ‚öôÔ∏è Configuraci√≥n

Ir a: `Acciones posteriores a la ejecuci√≥n` ‚Üí `+ A√±adir una acci√≥n` ‚Üí `Guardar los archivos generados`

![35.png](assets/section-07/35.png)

En el campo de ruta agregamos:

````bash
target/*.jar 
````

Adicionalmente, habilitamos: ‚úî `Archive artifacts only if build is successful`.

![36.png](assets/section-07/36.png)

üí° Buenas pr√°cticas reales

- Siempre archiva solo si la compilaci√≥n fue exitosa.
- Usa patrones `*.jar`, `*.war`, `*.zip` seg√∫n tu proyecto.
- Estos artefactos luego ser√°n usados por:
    - Pipelines de despliegue
    - Publicaci√≥n en Artifactory, Nexus o GitHub Packages
    - Versionamiento sem√°ntico

### üìÅ Resultado: √öltimo artefacto exitoso

Tras ejecutar nuevamente el job y recargar la p√°gina (F5), Jenkins mostrar√° el artefacto en la parte derecha:

````bash
√öltima Ejecuci√≥n Exitosa
my-app-1.0-SNAPSHOT.jar     2.61 KiB
````

![37.png](assets/section-07/37.png)

Esto confirma que tu pipeline ahora:

- Construye
- Ejecuta
- Archiva artefactos

Tal como lo hacen pipelines CI reales.
